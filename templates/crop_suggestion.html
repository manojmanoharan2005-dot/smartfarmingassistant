{% extends "base.html" %}

{% block title %}Crop Suggestion - Smart Farming Assistant{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/crop_suggestion.css') }}">

{% endblock %}

{% block content %}
<div class="dashboard-layout">
    <!-- Sidebar -->
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">üåæ</div>
            <div>
                <div class="sidebar-title">Smart Farming</div>
                <div class="sidebar-subtitle">Agricultural Platform</div>
            </div>
        </div>

        <nav class="sidebar-nav">
            <div class="nav-section">
                <div class="nav-section-title">Main Menu</div>
                <a href="{{ url_for('dashboard.dashboard') }}" class="nav-link">
                    <i class="fas fa-th-large"></i>
                    <span>Dashboard</span>
                </a>
                <a href="{{ url_for('crop.crop_suggestion') }}" class="nav-link active">
                    <i class="fas fa-seedling"></i>
                    <span>Crop Suggestion</span>
                </a>
                <a href="{{ url_for('fertilizer.fertilizer_recommend') }}" class="nav-link">
                    <i class="fas fa-flask"></i>
                    <span>Fertilizer Advice</span>
                </a>
                <!-- Disease Detection - Coming Soon -->
                <a href="#" class="nav-link" style="opacity: 0.5; cursor: not-allowed;" onclick="return false;">
                    <i class="fas fa-microscope"></i>
                    <span>Disease Detection</span>
                    <span class="badge" style="background: #6b7280;">Soon</span>
                </a>
                <a href="{{ url_for('market.market_watch') }}" class="nav-link">
                    <i class="fas fa-chart-line"></i>
                    <span>Market Prices</span>
                    <span class="badge">Live</span>
                </a>
            </div>


        </nav>

        <div class="sidebar-user">
            <div class="user-info" onclick="openProfileModal()" style="cursor: pointer;">
                <div class="user-avatar">{{ user_name[0] if user_name else 'U' }}</div>
                <div class="user-details">
                    <h4>{{ user_name }}</h4>
                    <span>Farmer</span>
                </div>
                <i class="fas fa-chevron-right" style="margin-left: auto; opacity: 0.5; font-size: 12px;"></i>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Hero Header -->
        <div class="hero-header">
            <div class="hero-content">
                <div class="welcome-text">
                    <i class="fas fa-seedling"></i> AI-Powered Analysis
                </div>
                <h1 class="hero-title">Smart Crop Recommendation</h1>
                <p class="hero-subtitle">Get scientific crop suggestions based on your soil nutrients and climate
                    conditions using machine learning.</p>
            </div>
        </div>

        <!-- Stats Bar -->
        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-icon green"><i class="fas fa-leaf"></i></div>
                <div class="stat-info">
                    <h4>22+</h4>
                    <span>Crops Analyzed</span>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-icon blue"><i class="fas fa-flask"></i></div>
                <div class="stat-info">
                    <h4>7</h4>
                    <span>Input Parameters</span>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-icon purple"><i class="fas fa-brain"></i></div>
                <div class="stat-info">
                    <h4>ML</h4>
                    <span>AI Powered</span>
                </div>
            </div>
            <div style="margin-left: auto;">
                <a href="{{ url_for('auth.logout') }}"
                    style="background: rgba(239, 68, 68, 0.2); color: #ef4444; padding: 12px 20px; border-radius: 8px; text-decoration: none; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </div>
        </div>

        <!-- Dashboard Content -->
        <div class="dashboard-content">
            <!-- Input Form -->
            <div class="form-card">
                <div class="form-card-header">
                    <div class="icon"><i class="fas fa-seedling"></i></div>
                    <div>
                        <h2>Enter Your Field Data</h2>
                        <p>Provide soil nutrient levels and environmental conditions for accurate recommendations</p>
                    </div>
                </div>
                <div class="form-card-body">
                    <form method="POST">
                        <!-- Soil Nutrients Section -->
                        <div class="form-section">
                            <div class="form-section-title">
                                <i class="fas fa-flask"></i>
                                Soil Nutrients (mg/kg)
                            </div>
                            <div class="input-grid">
                                <div class="input-group">
                                    <label><i class="fas fa-atom"></i> Nitrogen (N)</label>
                                    <input type="number" name="nitrogen" placeholder="80" step="0.01" required
                                        value="{{ input_data.nitrogen if input_data else '' }}">
                                    <small>Range: 0-140 mg/kg (Avg: 80)</small>
                                </div>
                                <div class="input-group">
                                    <label><i class="fas fa-atom"></i> Phosphorus (P)</label>
                                    <input type="number" name="phosphorous" placeholder="60" step="0.01" required
                                        value="{{ input_data.phosphorous if input_data else '' }}">
                                    <small>Range: 5-145 mg/kg (Avg: 60)</small>
                                </div>
                                <div class="input-group">
                                    <label><i class="fas fa-atom"></i> Potassium (K)</label>
                                    <input type="number" name="potassium" placeholder="40" step="0.01" required
                                        value="{{ input_data.potassium if input_data else '' }}">
                                    <small>Range: 5-205 mg/kg (Avg: 40)</small>
                                </div>
                            </div>
                        </div>

                        <!-- Environmental Conditions -->
                        <div class="form-section">
                            <div class="form-section-title">
                                <i class="fas fa-cloud-sun"></i>
                                Environmental Conditions
                            </div>
                            <div class="input-grid">
                                <div class="input-group">
                                    <label><i class="fas fa-thermometer-half"></i> Temperature (¬∞C)</label>
                                    <input type="number" name="temperature" placeholder="25" step="0.01" required
                                        value="{{ input_data.temperature if input_data else '' }}">
                                    <small>Range: 8-44¬∞C (Avg: 26¬∞C)</small>
                                </div>
                                <div class="input-group">
                                    <label><i class="fas fa-tint"></i> Humidity (%)</label>
                                    <input type="number" name="humidity" placeholder="70" step="0.01" min="0" max="100"
                                        required value="{{ input_data.humidity if input_data else '' }}">
                                    <small>Range: 14-100% (Avg: 70%)</small>
                                </div>
                                <div class="input-group">
                                    <label><i class="fas fa-vial"></i> Soil pH Level</label>
                                    <input type="number" name="ph" placeholder="6.5" step="0.01" min="0" max="14"
                                        required value="{{ input_data.ph if input_data else '' }}">
                                    <small>Range: 3.5-9.9 (Avg: 6.5)</small>
                                </div>
                                <div class="input-group">
                                    <label><i class="fas fa-cloud-rain"></i> Annual Rainfall (mm)</label>
                                    <input type="number" name="rainfall" placeholder="100" step="0.01" required
                                        value="{{ input_data.rainfall if input_data else '' }}">
                                    <small>Range: 20-300mm (Avg: 100mm)</small>
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="submit-btn">
                            <i class="fas fa-magic"></i>
                            Get AI Crop Recommendations
                        </button>
                    </form>
                </div>
            </div>

            <!-- Results Section -->
            {% if categorized_recommendations %}
            {% for category, crops in categorized_recommendations.items() %}
            <div class="results-section">
                <div class="results-header">
                    <div class="results-title">
                        {% if category == 'Fruits' %}<i class="fas fa-apple-alt"></i>
                        {% elif category == 'Vegetables' %}<i class="fas fa-carrot"></i>
                        {% elif category == 'Grains & Cereals' %}<i class="fas fa-seedling"></i>
                        {% else %}<i class="fas fa-leaf"></i>{% endif %}
                        {{ category }}
                    </div>
                </div>
                <div class="crop-results-grid">
                    {% for crop in crops %}
                    <div class="crop-result-card {{ 'primary' if crop.priority == 'High' else '' }}">
                        <div class="crop-card-header">
                            <div class="crop-icon">
                                {% if crop.name|lower in ['rice', 'wheat', 'maize'] %}üåæ
                                {% elif crop.name|lower in ['apple', 'mango', 'banana', 'orange', 'grapes'] %}üçé
                                {% elif crop.name|lower in ['coffee'] %}‚òï
                                {% elif crop.name|lower in ['cotton'] %}üß∂
                                {% else %}üå±{% endif %}
                            </div>
                            <div>
                                <h3>{{ crop.name|title }}</h3>
                                <span class="confidence-badge">
                                    <i class="fas fa-star"></i>
                                    {{ crop.confidence_percentage|round|int }}% Match
                                </span>
                            </div>
                        </div>
                        <div class="crop-card-body">
                            <div class="crop-info-grid">
                                <div class="crop-info-item">
                                    <div class="value">{{ crop.season or 'Kharif' }}</div>
                                    <div class="label">Best Season</div>
                                </div>
                                <div class="crop-info-item">
                                    <div class="value">{{ crop.duration or '90-120' }}</div>
                                    <div class="label">Days to Harvest</div>
                                </div>
                                <div class="crop-info-item">
                                    <div class="value">{{ crop.water or 'Medium' }}</div>
                                    <div class="label">Water Need</div>
                                </div>
                                <div class="crop-info-item">
                                    <div class="value">{{ crop.priority }}</div>
                                    <div class="label">Priority</div>
                                </div>
                            </div>
                        </div>
                        <div class="crop-card-footer">
                            <a href="{{ url_for('growing.start_growing', crop_name=crop.name, probability=crop.probability) }}"
                                class="crop-action-btn primary">
                                <i class="fas fa-play"></i> Start Growing
                            </a>
                            <button class="crop-action-btn secondary" onclick="alert('Details coming soon!')">
                                <i class="fas fa-info-circle"></i> Details
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
            {% elif recommendations %}
            <div class="results-section">
                <div class="results-header">
                    <div class="results-title">
                        <i class="fas fa-check-circle"></i>
                        Recommended Crops for Your Field
                    </div>
                </div>
                <div class="crop-results-grid">
                    {% for crop in recommendations %}
                    <div class="crop-result-card {{ 'primary' if loop.index == 1 else '' }}">
                        <div class="crop-card-header">
                            <div class="crop-icon">
                                {% if crop.name|lower in ['rice', 'wheat', 'maize'] %}üåæ
                                {% elif crop.name|lower in ['apple', 'mango', 'banana', 'orange', 'grapes'] %}üçé
                                {% elif crop.name|lower in ['coffee'] %}‚òï
                                {% elif crop.name|lower in ['cotton'] %}üß∂
                                {% else %}üå±{% endif %}
                            </div>
                            <div>
                                <h3>{{ crop.name|title }}</h3>
                                <span class="confidence-badge">
                                    <i class="fas fa-star"></i>
                                    {{ crop.confidence_percentage|round|int }}% Match
                                </span>
                            </div>
                        </div>
                        <div class="crop-card-body">
                            <div class="crop-info-grid">
                                <div class="crop-info-item">
                                    <div class="value">{{ crop.season or 'Kharif' }}</div>
                                    <div class="label">Best Season</div>
                                </div>
                                <div class="crop-info-item">
                                    <div class="value">{{ crop.duration or '90-120' }}</div>
                                    <div class="label">Days to Harvest</div>
                                </div>
                                <div class="crop-info-item">
                                    <div class="value">{{ crop.water or 'Medium' }}</div>
                                    <div class="label">Water Need</div>
                                </div>
                                <div class="crop-info-item">
                                    <div class="value">#{{ loop.index }}</div>
                                    <div class="label">Rank</div>
                                </div>
                            </div>
                        </div>
                        <div class="crop-card-footer">
                            <a href="{{ url_for('growing.start_growing', crop_name=crop.name, probability=crop.probability) }}"
                                class="crop-action-btn primary">
                                <i class="fas fa-play"></i> Start Growing
                            </a>
                            <button class="crop-action-btn secondary" onclick="alert('Details coming soon!')">
                                <i class="fas fa-info-circle"></i> Details
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}