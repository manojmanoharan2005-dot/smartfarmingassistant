{% extends "base.html" %}

{% block title %}Market Watch - Smart Farming Assistant{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/market_watch.css') }}">

{% endblock %}

{% block content %}
<div class="dashboard-layout">
    <!-- Mobile Sidebar Overlay -->
    <div class="sidebar-overlay" onclick="toggleSidebar()"></div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">üåæ</div>
            <div>
                <div class="sidebar-title">Smart Farming</div>
                <div class="sidebar-subtitle">Agricultural Platform</div>
            </div>
        </div>

        <nav class="sidebar-nav">
            <div class="nav-section">
                <div class="nav-section-title">Main Menu</div>
                <a href="{{ url_for('dashboard.dashboard') }}" class="nav-link">
                    <i class="fas fa-th-large"></i>
                    <span>Dashboard</span>
                </a>
                <a href="{{ url_for('crop.crop_suggestion') }}" class="nav-link">
                    <i class="fas fa-seedling"></i>
                    <span>Crop Suggestion</span>
                </a>
                <a href="{{ url_for('fertilizer.fertilizer_recommend') }}" class="nav-link">
                    <i class="fas fa-flask"></i>
                    <span>Fertilizer Advice</span>
                </a>

                <a href="{{ url_for('market.market_watch') }}" class="nav-link active">
                    <i class="fas fa-chart-line"></i>
                    <span>Market Prices</span>
                    <span class="badge">Live</span>
                </a>
                <a href="{{ url_for('resources.regional_calendar') }}" class="nav-link">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Regional Calendar</span>
                </a>
            </div>




        </nav>

        <div class="sidebar-user">
            <div class="user-info" onclick="openProfileModal()" style="cursor: pointer;">
                <div class="user-avatar">{{ user_name[0] if user_name else 'U' }}</div>
                <div class="user-details">
                    <h4>{{ user_name }}</h4>
                    <span>Farmer</span>
                </div>
                <i class="fas fa-chevron-right" style="margin-left: auto; opacity: 0.5; font-size: 12px;"></i>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Mobile Sidebar Toggle -->
        <button class="mobile-sidebar-toggle" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Hero Header -->
        <div class="hero-header" style="background: white;">
            <div class="hero-content">
                <div class="welcome-text">
                    <i class="fas fa-chart-line"></i> Real-Time Updates
                </div>
                <h1 class="hero-title">Live Market Prices</h1>
                <p class="hero-subtitle">Track commodity prices across 69,580+ markets in India. Updated daily at 9:00
                    AM.</p>
            </div>
        </div>

        <!-- Stats Bar -->
        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-icon blue"><i class="fas fa-store"></i></div>
                <div class="stat-info">
                    <h4>{{ total_records or '28,400' }}</h4>
                    <span>Total Records</span>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-icon green"><i class="fas fa-map-marker-alt"></i></div>
                <div class="stat-info">
                    <h4>{{ total_states or '29' }}</h4>
                    <span>States Covered</span>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-icon orange"><i class="fas fa-carrot"></i></div>
                <div class="stat-info">
                    <h4>70+</h4>
                    <span>Commodities</span>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-icon purple"><i class="fas fa-clock"></i></div>
                <div class="stat-info">
                    <h4>9 AM</h4>
                    <span>Daily Update</span>
                </div>
            </div>
            <div style="margin-left: auto;">
                <a href="{{ url_for('auth.logout') }}"
                    style="background: rgba(239, 68, 68, 0.2); color: #ef4444; padding: 12px 20px; border-radius: 8px; text-decoration: none; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </div>
        </div>

        <!-- Dashboard Content -->
        <div class="dashboard-content">
            <!-- Filter Card -->
            <div class="filter-card">
                <form method="GET" class="filter-row">
                    <div class="filter-group">
                        <label><i class="fas fa-map"></i> State</label>
                        <select name="state" id="stateSelect" onchange="updateDistricts()">
                            <option value="All States">All States</option>
                            {% for state in states %}
                            <option value="{{ state }}" {% if selected_state==state %}selected{% endif %}>{{ state }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="filter-group">
                        <label><i class="fas fa-building"></i> District</label>
                        <select name="district" id="districtSelect">
                            <option value="All Districts">All Districts</option>
                            {% for district in districts %}
                            <option value="{{ district }}" {% if selected_district==district %}selected{% endif %}>{{
                                district }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="filter-group">
                        <label><i class="fas fa-carrot"></i> Commodity</label>
                        <input type="text" name="commodity_search" id="commoditySearch"
                            placeholder="Search commodity..."
                            value="{{ selected_commodity if selected_commodity and selected_commodity != 'All' else '' }}"
                            autocomplete="off"
                            style="width: 100%; padding: 12px 16px; border: 2px solid var(--border-color); border-radius: var(--radius-md); font-size: 14px;">
                        <div id="commoditySuggestions"
                            style="display: none; position: absolute; background: white; border: 1px solid var(--border-color); border-radius: 8px; max-height: 200px; overflow-y: auto; z-index: 100; width: calc(100% - 32px); box-shadow: var(--shadow-md);">
                        </div>
                    </div>
                    <div class="filter-group" style="min-width: 180px;">
                        <label><i class="fas fa-filter"></i> Category</label>
                        <select name="commodity" id="commoditySelect">
                            <option value="All" {% if selected_commodity=='All' or not selected_commodity %}selected{%
                                endif %}>All Commodities</option>
                            <option value="Vegetables" {% if selected_commodity=='Vegetables' %}selected{% endif %}>ü•¨ Vegetables ({{ vegetables|length }})</option>
                            <option value="Fruits" {% if selected_commodity=='Fruits' %}selected{% endif %}>üçé Fruits ({{ fruits|length }})</option>
                            <option value="Grains" {% if selected_commodity=='Grains' %}selected{% endif %}>üåæ Grains ({{ cereals|length }})</option>
                            <option value="Pulses" {% if selected_commodity=='Pulses' %}selected{% endif %}>ü´ò Pulses ({{ pulses|length }})</option>
                            <option value="Oilseeds" {% if selected_commodity=='Oilseeds' %}selected{% endif %}>üåª Oilseeds ({{ oilseeds|length }})</option>
                            <option value="Spices" {% if selected_commodity=='Spices' %}selected{% endif %}>üå∂Ô∏è Spices ({{ spices|length }})</option>
                            <option value="Commercial Crops" {% if selected_commodity=='Commercial Crops' %}selected{% endif %}>üåø Commercial Crops ({{ commercial|length }})</option>
                            <option value="Dry Fruits" {% if selected_commodity=='Dry Fruits' %}selected{% endif %}>ü•ú Dry Fruits ({{ dry_fruits|length }})</option>
                            <option value="Animal Products" {% if selected_commodity=='Animal Products' %}selected{% endif %}>ü•õ Animal Products ({{ animal|length }})</option>
                        </select>
                    </div>
                    <button type="submit" class="filter-btn">
                        <i class="fas fa-search"></i> Search
                    </button>
                </form>
            </div>

            <!-- Summary Cards -->
            <div class="summary-cards">

                <div class="summary-card">
                    <div class="icon orange">ü•¨</div>
                    <div class="info">
                        <h4>{{ vegetables|length }}</h4>
                        <p>Vegetables</p>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="icon purple">üçé</div>
                    <div class="info">
                        <h4>{{ fruits|length }}</h4>
                        <p>Fruits</p>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="icon green">üåæ</div>
                    <div class="info">
                        <h4>{{ cereals|length }}</h4>
                        <p>Grains</p>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="icon blue">ü´ò</div>
                    <div class="info">
                        <h4>{{ pulses|length }}</h4>
                        <p>Pulses</p>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="icon orange">üåª</div>
                    <div class="info">
                        <h4>{{ oilseeds|length }}</h4>
                        <p>Oilseeds</p>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="icon purple">üå∂Ô∏è</div>
                    <div class="info">
                        <h4>{{ spices|length }}</h4>
                        <p>Spices</p>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="icon green">üåø</div>
                    <div class="info">
                        <h4>{{ commercial|length }}</h4>
                        <p>Commercial Crops</p>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="icon blue">ü•ú</div>
                    <div class="info">
                        <h4>{{ dry_fruits|length }}</h4>
                        <p>Dry Fruits</p>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="icon orange">ü•õ</div>
                    <div class="info">
                        <h4>{{ animal|length }}</h4>
                        <p>Animal Products</p>
                    </div>
                </div>
            </div>

            <!-- Market Grid -->
            {% if market_data %}

            {% set card_images = {
            'Tomato': '/static/images/tomato.png',
            'Onion': '/static/images/onion.png',
            'Potato': '/static/images/potato.jpg',
            'Brinjal': '/static/images/brinjal.png',
            'Cabbage': '/static/images/cabbage.jpg',
            'Cauliflower': '/static/images/cauliflower.jpg',
            'Carrot': '/static/images/carrot.jpg',
            'Apple': '/static/images/apple.jpg',
            'Banana': '/static/images/banana.png',
            'Orange': '/static/images/orange.png',
            'Pomegranate':
            'https://images.unsplash.com/photo-1615485925763-8678628890cb?auto=format&fit=crop&w=500&q=60',
            'Mango': '/static/images/mango.png',
            'Grapes': 'https://images.unsplash.com/photo-1596363505729-4190a9506133?auto=format&fit=crop&w=500&q=60',
            'Wheat': 'https://images.unsplash.com/photo-1574323347407-f5e1ad6d020b?auto=format&fit=crop&w=500&q=60',
            'Rice': 'https://images.unsplash.com/photo-1586201375761-83865001e31c?auto=format&fit=crop&w=500&q=60',
            'Paddy': 'https://images.unsplash.com/photo-1586201375761-83865001e31c?auto=format&fit=crop&w=500&q=60',
            'Maize': 'https://images.unsplash.com/photo-1551754655-cd27e38d2076?auto=format&fit=crop&w=500&q=60',
            'Barley': 'https://images.unsplash.com/photo-1536766465355-be2361667b2d?auto=format&fit=crop&w=500&q=60',
            'Jowar': 'https://images.unsplash.com/photo-1634467542740-023b14421d00?auto=format&fit=crop&w=500&q=60',
            'Sorghum': 'https://images.unsplash.com/photo-1634467542740-023b14421d00?auto=format&fit=crop&w=500&q=60',
            'Bajra': 'https://images.unsplash.com/photo-1601004890684-d8cbf643f5f2?auto=format&fit=crop&w=500&q=60',
            'Pearl Millet':
            'https://images.unsplash.com/photo-1601004890684-d8cbf643f5f2?auto=format&fit=crop&w=500&q=60',
            'Ragi': 'https://images.unsplash.com/photo-1609137021590-0f2c423c4a93?auto=format&fit=crop&w=500&q=60',
            'Cotton': 'https://images.unsplash.com/photo-1594895697660-f38449c258d4?auto=format&fit=crop&w=500&q=60',
            'Sugarcane': 'https://images.unsplash.com/photo-1601633512803-b097b6ec7f8f?auto=format&fit=crop&w=500&q=60',
            'Coffee': 'https://images.unsplash.com/photo-1559056199-641a0ac8b55e?auto=format&fit=crop&w=500&q=60',
            'Green Chilli': '/static/images/green_chilli.jpg',
            'Beetroot': '/static/images/beetroot.jpg',
            'Capsicum': '/static/images/capsicum.jpg',
            'Beans': '/static/images/beans.jpg',
            'Cluster Beans': '/static/images/cluster_beans.png',
            'Lady Finger': '/static/images/lady_finger.jpg',
            'Ladys Finger': '/static/images/lady_finger.jpg',
            'Bhindi': '/static/images/lady_finger.jpg',
            'Drumstick': '/static/images/drumstick.jpg',
            'Bottle Gourd': '/static/images/bottle_gourd.png',
            'Sponge Gourd': '/static/images/sponge_gourd.png',
            'Ridge Gourd': '/static/images/sponge_gourd.png',
            'Snake Gourd': '/static/images/snake_gourd.png',
            'Bitter Gourd': '/static/images/bitter_gourd.png',
            'Pumpkin': '/static/images/pumpkin.jpg',
            'Radish': '/static/images/radish.jpg',
            'Ash Gourd': '/static/images/ash_gourd.png',
            'Turnip': '/static/images/turnip.jpg',
            'Sweet Corn': 'https://images.unsplash.com/photo-1551754655-cd27e38d2076?auto=format&fit=crop&w=500&q=60',
            'Peas': 'https://images.unsplash.com/photo-1592444641151-6d744b76c8c6?auto=format&fit=crop&w=500&q=60',
            'Garlic': 'https://images.unsplash.com/photo-1615477810688-668832a87426?auto=format&fit=crop&w=500&q=60',
            'Ginger': 'https://images.unsplash.com/photo-1629153579126-11f845014c47?auto=format&fit=crop&w=500&q=60',
            'Spinach': 'https://images.unsplash.com/photo-1576045057995-568f588f82fb?auto=format&fit=crop&w=500&q=60',
            'Lemon': 'https://images.unsplash.com/photo-1595855799863-1250325bdfa4?auto=format&fit=crop&w=500&q=60',
            'Papaya': 'https://images.unsplash.com/photo-1617117833203-c91b44773aba?auto=format&fit=crop&w=500&q=60',
            'Pineapple':
            'https://plus.unsplash.com/premium_photo-1675715924050-69255be3269b?auto=format&fit=crop&w=500&q=60',
            'Mosambi': 'https://images.unsplash.com/photo-1623854746401-b51f807f354f?auto=format&fit=crop&w=500&q=60',
            'Groundnut': 'https://images.unsplash.com/photo-1589927986089-35812388d1f4?auto=format&fit=crop&w=500&q=60',
            'Mustard': 'https://images.unsplash.com/photo-1615485500834-bc10199bc727?auto=format&fit=crop&w=500&q=60',
            'Sunflower': 'https://images.unsplash.com/photo-1597848212624-e4c0e6d1b9b1?auto=format&fit=crop&w=500&q=60',
            'Sesamum': 'https://images.unsplash.com/photo-1612530182604-0373df899533?auto=format&fit=crop&w=500&q=60',
            'Soyabean': 'https://images.unsplash.com/photo-1612530182604-0373df899533?auto=format&fit=crop&w=500&q=60',
            'Soybean': 'https://images.unsplash.com/photo-1612530182604-0373df899533?auto=format&fit=crop&w=500&q=60',
            'Castor': 'https://images.unsplash.com/photo-1589927986089-35812388d1f4?auto=format&fit=crop&w=500&q=60',
            'Linseed': 'https://images.unsplash.com/photo-1597848212624-e4c0e6d1b9b1?auto=format&fit=crop&w=500&q=60',
            'Coconut': 'https://images.unsplash.com/photo-1598511757337-fe2cafc31ba0?auto=format&fit=crop&w=500&q=60',
            'Turmeric': 'https://images.unsplash.com/photo-1615485500834-bc10199bc727?auto=format&fit=crop&w=500&q=60',
            'Chilly': 'https://images.unsplash.com/photo-1583454155184-870a1f63aebc?auto=format&fit=crop&w=500&q=60',
            'Red Chilli':
            'https://images.unsplash.com/photo-1583454155184-870a1f63aebc?auto=format&fit=crop&w=500&q=60',
            'Coriander': 'https://images.unsplash.com/photo-1615485290382-441e4d049cb5?auto=format&fit=crop&w=500&q=60',
            'Cumin': 'https://images.unsplash.com/photo-1596040033229-a0b3b1c8e4c5?auto=format&fit=crop&w=500&q=60',
            'Tea': 'https://images.unsplash.com/photo-1597318130159-b8f6c223f785?auto=format&fit=crop&w=500&q=60',
            'Jute': 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?auto=format&fit=crop&w=500&q=60',
            'Tobacco': 'https://images.unsplash.com/photo-1464297162577-f5295c892194?auto=format&fit=crop&w=500&q=60',
            'Cashewnut': 'https://images.unsplash.com/photo-1599599810769-bcde5a160d32?auto=format&fit=crop&w=500&q=60',
            'Almond': 'https://images.unsplash.com/photo-1508736793122-f516e3ba5569?auto=format&fit=crop&w=500&q=60',
            'Raisin': 'https://images.unsplash.com/photo-1587049352846-4a222e784acc?auto=format&fit=crop&w=500&q=60',
            'Walnut': 'https://images.unsplash.com/photo-1622484211052-6b1c7f5d6f1e?auto=format&fit=crop&w=500&q=60',
            'Milk': 'https://images.unsplash.com/photo-1563636619-e9143da7973b?auto=format&fit=crop&w=500&q=60',
            'Egg': 'https://images.unsplash.com/photo-1582722872445-44dc5f7e3c8f?auto=format&fit=crop&w=500&q=60',
            'Chicken': 'https://images.unsplash.com/photo-1587593810167-a84920ea0781?auto=format&fit=crop&w=500&q=60',
            'Poultry': 'https://images.unsplash.com/photo-1587593810167-a84920ea0781?auto=format&fit=crop&w=500&q=60',
            'Fish': 'https://images.unsplash.com/photo-1544943910-4c1dc44aab44?auto=format&fit=crop&w=500&q=60',
            'Bengal Gram':
            'https://images.unsplash.com/photo-1587049352846-4a222e784acc?auto=format&fit=crop&w=500&q=60',
            'Black Gram': 'https://images.unsplash.com/photo-1550953683-g4a428230554?auto=format&fit=crop&w=500&q=60',
            'Green Gram':
            'https://images.unsplash.com/photo-1596040033229-a0b3b1c8e4c5?auto=format&fit=crop&w=500&q=60',
            'Red Gram': 'https://images.unsplash.com/photo-1587049352846-4a222e784acc?auto=format&fit=crop&w=500&q=60',
            'Lentil': 'https://images.unsplash.com/photo-1587049352846-4a222e784acc?auto=format&fit=crop&w=500&q=60',
            'Arhar': 'https://images.unsplash.com/photo-1587049352846-4a222e784acc?auto=format&fit=crop&w=500&q=60',
            'Gram': 'https://images.unsplash.com/photo-1587049352846-4a222e784acc?auto=format&fit=crop&w=500&q=60',
            'Moong': 'https://images.unsplash.com/photo-1596040033229-a0b3b1c8e4c5?auto=format&fit=crop&w=500&q=60',
            'Urad': 'https://images.unsplash.com/photo-1550953683-g4a428230554?auto=format&fit=crop&w=500&q=60',
            'Tur': 'https://images.unsplash.com/photo-1587049352846-4a222e784acc?auto=format&fit=crop&w=500&q=60',
            'Masur': 'https://images.unsplash.com/photo-1587049352846-4a222e784acc?auto=format&fit=crop&w=500&q=60',
            'Watermelon': '/static/images/watermelon.jpg',
            'Water Melon': '/static/images/watermelon.jpg',
            'Muskmelon': '/static/images/muskmelon.jpg',
            'Musk Melon': '/static/images/muskmelon.jpg',
            'Guava': '/static/images/guava.png',
            'Mosambi': '/static/images/mosambi.png',
            'Sweet Lime': '/static/images/mosambi.png',
            'Pomegranate': '/static/images/pomegranate.png',
            'Anar': '/static/images/pomegranate.png',
            'Papaya': '/static/images/papaya.jpg',
            'Papita': '/static/images/papaya.jpg',
            'Pineapple': '/static/images/pineapple.jpg',
            'Ananas': '/static/images/pineapple.jpg',
            'Lemon': '/static/images/lemon.jpg',
            'Lime': '/static/images/lemon.jpg',
            'Nimbu': '/static/images/lemon.jpg',
            'Grapes': '/static/images/grapes.png',
            'Sapota': '/static/images/sapota.png',
            'Custard Apple': '/static/images/custard_apple.jpg',
            'Sitaphal': '/static/images/custard_apple.jpg',
            'Kiwi': '/static/images/kiwi.png',
            'Strawberry': '/static/images/strawberry.jpg',
            'Pear': '/static/images/pear.png',
            'Nashpati': '/static/images/pear.png',
            'Plum': '/static/images/plum.png',
            'Peach': '/static/images/peach.png',
            'Adoo': '/static/images/peach.png'
            } %}

            <style>
                /* Animation Keyframes */
                @keyframes fadeInUp {
                    from {
                        opacity: 0;
                        transform: translateY(20px);
                    }

                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }

                /* Grid Layout for Dashboard */
                .market-dashboard-grid {
                    display: grid;
                    grid-template-columns: repeat(2, 1fr);
                    gap: 20px;
                    padding-bottom: 40px;
                }

                @media (max-width: 992px) {
                    .market-dashboard-grid {
                        grid-template-columns: 1fr;
                    }
                }

                /* Category Panel */
                .market-category-panel {
                    background: white;
                    border-radius: 12px;
                    overflow: hidden;
                    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
                    display: flex;
                    flex-direction: column;
                    opacity: 0;
                    animation: fadeInUp 0.5s ease-out forwards;
                    height: 100%;
                    /* Match height in row */
                }

                .market-category-panel:nth-child(1) {
                    animation-delay: 0.1s;
                }

                .market-category-panel:nth-child(2) {
                    animation-delay: 0.2s;
                }

                .market-category-panel:nth-child(3) {
                    animation-delay: 0.3s;
                }

                .market-category-panel:nth-child(4) {
                    animation-delay: 0.4s;
                }

                /* Panel Headers with varying colors */
                .panel-header {
                    padding: 12px 16px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    color: white;
                }

                .panel-header h2 {
                    font-size: 20px;
                    font-weight: 700;
                    margin: 0;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                }

                .panel-header-icon {
                    font-size: 22px;
                }

                .panel-link {
                    color: rgba(255, 255, 255, 0.9);
                    font-size: 12px;
                    text-decoration: none;
                    font-weight: 600;
                    display: flex;
                    align-items: center;
                    gap: 4px;
                }

                .panel-link:hover {
                    color: white;
                    transform: translateX(2px);
                    transition: transform 0.2s;
                }

                /* Panel Colors */
                .panel-red {
                    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
                }

                .panel-yellow {
                    background: linear-gradient(135deg, #eab308 0%, #ca8a04 100%);
                }

                .panel-green {
                    background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
                }

                .panel-brown {
                    background: linear-gradient(135deg, #92400e 0%, #78350f 100%);
                }

                .panel-maroon {
                    background: linear-gradient(135deg, #4d7c0f 0%, #3f6212 100%);
                }

                .panel-purple {
                    background: linear-gradient(135deg, #64748b 0%, #475569 100%);
                }

                .panel-blue {
                    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
                }

                .panel-amber {
                    background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
                }

                .panel-body {
                    padding: 16px;
                    background: #fff;
                    flex-grow: 1;
                    /* Horizontal scrolling */
                    display: flex;
                    overflow-x: auto;
                    gap: 16px;
                    scrollbar-width: thin;
                    padding-bottom: 8px;
                    /* Space for scrollbar */
                }

                .panel-body::-webkit-scrollbar {
                    height: 4px;
                }

                .panel-body::-webkit-scrollbar-track {
                    background: transparent;
                }

                .panel-body::-webkit-scrollbar-thumb {
                    background: #cbd5e1;
                    border-radius: 4px;
                }

                /* Mini Card Styling */
                .mini-card {
                    flex: 0 0 170px;
                    width: 170px;
                    background: white;
                    /* border: 1px solid #e2e8f0; */
                    border-radius: 8px;
                    overflow: hidden;
                    transition: all 0.2s;
                    display: flex;
                    flex-direction: column;
                    position: relative;

                }

                .mini-card:hover {
                    /* transform: translateY(-2px); */
                    /* box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); */
                }

                .mini-card-img-box {
                    height: 110px;
                    width: 100%;
                    border-radius: 8px;
                    overflow: hidden;
                    position: relative;
                    margin-bottom: 8px;
                }

                .mini-card-img {
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                }

                .mini-card-details {
                    display: flex;
                    flex-direction: column;
                    gap: 2px;
                }

                .mini-card-title {
                    font-size: 16px;
                    font-weight: 700;
                    color: #0f172a;
                    white-space: nowrap;
                    overflow: hidden;
                    text-overflow: ellipsis;
                }

                .mini-card-price {
                    font-size: 20px;
                    font-weight: 800;
                    color: #1e293b;
                }

                .mini-card-unit {
                    font-size: 13px;
                    color: #64748b;
                    font-weight: 400;
                }

                .mini-card-loc {
                    font-size: 12px;
                    color: #94a3b8;
                    display: flex;
                    align-items: center;
                    gap: 3px;
                    margin-top: 2px;
                }

                .mini-card-loc i {
                    font-size: 11px;
                }

                .btn-buy {
                    background-color: #2563eb;
                    color: white;
                    border: none;
                    padding: 4px 12px;
                    border-radius: 4px;
                    font-size: 12px;
                    font-weight: 600;
                    cursor: pointer;
                    margin-left: auto;
                    transition: background-color 0.2s;
                }

                .btn-buy:hover {
                    background-color: #1d4ed8;
                }

                .card-footer-row {
                    display: flex;
                    justify-content: space-between;
                    align-items: flex-end;
                    margin-top: 4px;
                }

                .btn-buy {
                    background-color: #2563eb;
                    color: white;
                    border: none;
                    padding: 4px 12px;
                    border-radius: 4px;
                    font-size: 12px;
                    font-weight: 600;
                    cursor: pointer;
                    margin-left: auto;
                    transition: background-color 0.2s;
                }

            <style>
                /* Modern Market Cards Design */
                .market-categories-container {
                    display: flex;
                    flex-direction: column;
                    gap: 32px;
                    padding: 20px 0;
                }

                .category-section {
                    background: white;
                    border-radius: 20px;
                    padding: 24px;
                    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
                    border: 1px solid rgba(0, 0, 0, 0.06);
                }

                .category-header {
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    margin-bottom: 20px;
                    padding-bottom: 16px;
                    border-bottom: 1px solid #f1f5f9;
                }

                .category-title {
                    display: flex;
                    align-items: center;
                    gap: 12px;
                    font-size: 24px;
                    font-weight: 700;
                    color: #1e293b;
                    margin: 0;
                }

                .category-icon {
                    width: 48px;
                    height: 48px;
                    border-radius: 12px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 24px;
                    background: linear-gradient(135deg, #10b981, #059669);
                    color: white;
                    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
                }

                .fruits-icon {
                    background: linear-gradient(135deg, #f59e0b, #d97706) !important;
                    box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3) !important;
                }

                .category-count {
                    font-size: 14px;
                    color: #64748b;
                    font-weight: 500;
                }

                .products-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                    gap: 20px;
                }

                .product-card {
                    background: white;
                    border-radius: 16px;
                    overflow: hidden;
                    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
                    border: 1px solid rgba(0, 0, 0, 0.06);
                    transition: all 0.3s ease;
                    position: relative;
                }

                .product-card:hover {
                    transform: translateY(-4px);
                    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.12);
                }

                .product-image-container {
                    position: relative;
                    height: 120px;
                    overflow: hidden;
                    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
                }

                .product-image {
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                    transition: transform 0.3s ease;
                }

                .product-card:hover .product-image {
                    transform: scale(1.05);
                }

                .product-indicator {
                    position: absolute;
                    top: 12px;
                    left: 12px;
                    width: 12px;
                    height: 12px;
                    border-radius: 50%;
                    background: #10b981;
                    border: 2px solid white;
                    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                }

                .product-content {
                    padding: 16px;
                }

                .product-name {
                    font-size: 18px;
                    font-weight: 700;
                    color: #1e293b;
                    margin: 0 0 8px 0;
                    line-height: 1.3;
                }

                .product-location {
                    display: flex;
                    align-items: center;
                    gap: 6px;
                    color: #64748b;
                    font-size: 14px;
                    margin-bottom: 16px;
                }

                .location-icon {
                    font-size: 12px;
                    color: #94a3b8;
                }

                .price-section {
                    display: flex;
                    justify-content: space-between;
                    align-items: flex-start;
                    gap: 16px;
                }

                .price-info {
                    flex: 1;
                }

                .main-price {
                    font-size: 24px;
                    font-weight: 800;
                    color: #0f172a;
                    margin: 0;
                    line-height: 1.2;
                }

                .price-unit {
                    font-size: 14px;
                    color: #64748b;
                    font-weight: 500;
                }

                .price-details {
                    display: flex;
                    gap: 12px;
                    margin-top: 8px;
                }

                .price-detail {
                    font-size: 12px;
                    color: #64748b;
                }

                .price-label {
                    color: #94a3b8;
                    margin-right: 4px;
                }

                .price-value {
                    font-weight: 600;
                    color: #475569;
                }

                .category-badge {
                    position: absolute;
                    top: 12px;
                    right: 12px;
                    background: rgba(255, 255, 255, 0.95);
                    color: #64748b;
                    font-size: 11px;
                    font-weight: 600;
                    padding: 4px 8px;
                    border-radius: 6px;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                    backdrop-filter: blur(8px);
                }

                /* Responsive Design */
                @media (max-width: 768px) {
                    .products-grid {
                        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
                        gap: 16px;
                    }

                    .category-section {
                        padding: 20px 16px;
                        margin: 0 -8px;
                        border-radius: 16px;
                    }

                    .category-title {
                        font-size: 20px;
                    }

                    .category-icon {
                        width: 40px;
                        height: 40px;
                        font-size: 20px;
                    }

                    .product-image-container {
                        height: 100px;
                    }

                    .main-price {
                        font-size: 20px;
                    }
                }

                @media (max-width: 480px) {
                    .products-grid {
                        grid-template-columns: 1fr;
                    }

                    .price-section {
                        flex-direction: column;
                        gap: 8px;
                    }

                    .price-details {
                        justify-content: space-between;
                    }
                }

                /* Animation */
                @keyframes fadeInUp {
                    from {
                        opacity: 0;
                        transform: translateY(20px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }

                .product-card {
                    animation: fadeInUp 0.6s ease-out forwards;
                }

                .product-card:nth-child(1) { animation-delay: 0.1s; }
                .product-card:nth-child(2) { animation-delay: 0.2s; }
                .product-card:nth-child(3) { animation-delay: 0.3s; }
                .product-card:nth-child(4) { animation-delay: 0.4s; }
                .product-card:nth-child(5) { animation-delay: 0.5s; }
                .product-card:nth-child(6) { animation-delay: 0.6s; }
            </style>

            <div class="market-categories-container">
                <!-- Vegetables Section -->
                {% if vegetables %}
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-title">
                            <div class="category-icon">ü•¨</div>
                            <div>
                                <div>Vegetables</div>
                                <div class="category-count">{{ vegetables|length }} items available</div>
                            </div>
                        </div>
                        <div class="scroll-controls">
                            <button class="scroll-btn scroll-left" onclick="scrollCategory('vegetables', 'left')">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="scroll-btn scroll-right" onclick="scrollCategory('vegetables', 'right')">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    <div class="scroll-container">
                        <div class="products-grid-horizontal" id="vegetables-grid">
                        {% for item in vegetables %}
                        {% set clean_name = item.commodity.split('(')[0].strip() %}
                        {% set bg_image = card_images.get(clean_name, 'https://images.unsplash.com/photo-1610832958506-aa56368176cf?auto=format&fit=crop&w=500&q=60') %}
                        <div class="product-card">
                            <div class="product-image-container">
                                <img src="{{ bg_image }}" alt="{{ clean_name }}" class="product-image">
                                <div class="product-indicator"></div>
                                <div class="category-badge">Fresh</div>
                            </div>
                            <div class="product-content">
                                <h3 class="product-name">{{ clean_name }}</h3>
                                <div class="product-location">
                                    <i class="fas fa-map-marker-alt location-icon"></i>
                                    <span>{{ item.district }}, {{ item.state }}</span>
                                </div>
                                <div class="price-section">
                                    <div class="price-info">
                                        <div class="main-price">‚Çπ{{ "%.1f"|format(item.current_price_kg|float) }} <span class="price-unit">per kg</span></div>
                                        <div class="price-details">
                                            <div class="price-detail">
                                                <span class="price-label">Central Price:</span>
                                                <span class="price-value">‚Çπ{{ item.current_price_kg }}</span>
                                            </div>
                                            <div class="price-detail">
                                                <span class="price-label">Quoted Price:</span>
                                                <span class="price-value">‚Çπ{{ item.max_price_kg or item.current_price_kg }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Fruits Section -->
                {% if fruits %}
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-title">
                            <div class="category-icon fruits-icon">üçé</div>
                            <div>
                                <div>Fruits</div>
                                <div class="category-count">{{ fruits|length }} items available</div>
                            </div>
                        </div>
                        <div class="scroll-controls">
                            <button class="scroll-btn scroll-left" onclick="scrollCategory('fruits', 'left')">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="scroll-btn scroll-right" onclick="scrollCategory('fruits', 'right')">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    <div class="scroll-container">
                        <div class="products-grid-horizontal" id="fruits-grid">
                        {% for item in fruits %}
                        {% set clean_name = item.commodity.split('(')[0].strip() %}
                        {% set bg_image = card_images.get(clean_name, 'https://images.unsplash.com/photo-1610832958506-aa56368176cf?auto=format&fit=crop&w=500&q=60') %}
                        <div class="product-card">
                            <div class="product-image-container">
                                <img src="{{ bg_image }}" alt="{{ clean_name }}" class="product-image">
                                <div class="product-indicator"></div>
                                <div class="category-badge">Fresh</div>
                            </div>
                            <div class="product-content">
                                <h3 class="product-name">{{ clean_name }}</h3>
                                <div class="product-location">
                                    <i class="fas fa-map-marker-alt location-icon"></i>
                                    <span>{{ item.district }}, {{ item.state }}</span>
                                </div>
                                <div class="price-section">
                                    <div class="price-info">
                                        <div class="main-price">‚Çπ{{ "%.1f"|format(item.current_price_kg|float) }} <span class="price-unit">per kg</span></div>
                                        <div class="price-details">
                                            <div class="price-detail">
                                                <span class="price-label">Central Price:</span>
                                                <span class="price-value">‚Çπ{{ item.current_price_kg }}</span>
                                            </div>
                                            <div class="price-detail">
                                                <span class="price-label">Quoted Price:</span>
                                                <span class="price-value">‚Çπ{{ item.max_price_kg or item.current_price_kg }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Cereals & Grains Section -->
                {% if cereals %}
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-title">
                            <div class="category-icon" style="background: linear-gradient(135deg, #eab308, #ca8a04) !important; box-shadow: 0 4px 12px rgba(234, 179, 8, 0.3) !important;">üåæ</div>
                            <div>
                                <div>Cereals & Grains</div>
                                <div class="category-count">{{ cereals|length }} items available</div>
                            </div>
                        </div>
                        <div class="scroll-controls">
                            <button class="scroll-btn scroll-left" onclick="scrollCategory('cereals', 'left')">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="scroll-btn scroll-right" onclick="scrollCategory('cereals', 'right')">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    <div class="scroll-container">
                        <div class="products-grid-horizontal" id="cereals-grid">
                        {% for item in cereals %}
                        {% set clean_name = item.commodity.split('(')[0].strip() %}
                        {% set bg_image = card_images.get(clean_name, 'https://images.unsplash.com/photo-1574323347407-f5e1ad6d020b?auto=format&fit=crop&w=500&q=60') %}
                        <div class="product-card">
                            <div class="product-image-container">
                                <img src="{{ bg_image }}" alt="{{ clean_name }}" class="product-image">
                                <div class="product-indicator"></div>
                                <div class="category-badge">Grain</div>
                            </div>
                            <div class="product-content">
                                <h3 class="product-name">{{ clean_name }}</h3>
                                <div class="product-location">
                                    <i class="fas fa-map-marker-alt location-icon"></i>
                                    <span>{{ item.district }}, {{ item.state }}</span>
                                </div>
                                <div class="price-section">
                                    <div class="price-info">
                                        <div class="main-price">‚Çπ{{ "%.1f"|format(item.current_price_kg|float) }} <span class="price-unit">per kg</span></div>
                                        <div class="price-details">
                                            <div class="price-detail">
                                                <span class="price-label">Central Price:</span>
                                                <span class="price-value">‚Çπ{{ item.current_price_kg }}</span>
                                            </div>
                                            <div class="price-detail">
                                                <span class="price-label">Quoted Price:</span>
                                                <span class="price-value">‚Çπ{{ item.max_price_kg or item.current_price_kg }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Pulses Section -->
                {% if pulses %}
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-title">
                            <div class="category-icon" style="background: linear-gradient(135deg, #dc2626, #b91c1c) !important; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3) !important;">ü´ò</div>
                            <div>
                                <div>Pulses</div>
                                <div class="category-count">{{ pulses|length }} items available</div>
                            </div>
                        </div>
                        <div class="scroll-controls">
                            <button class="scroll-btn scroll-left" onclick="scrollCategory('pulses', 'left')">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="scroll-btn scroll-right" onclick="scrollCategory('pulses', 'right')">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    <div class="scroll-container">
                        <div class="products-grid-horizontal" id="pulses-grid">
                        {% for item in pulses %}
                        {% set clean_name = item.commodity.split('(')[0].strip() %}
                        {% set bg_image = card_images.get(clean_name, 'https://images.unsplash.com/photo-1596040033229-a0b3b1c8e4c5?auto=format&fit=crop&w=500&q=60') %}
                        <div class="product-card">
                            <div class="product-image-container">
                                <img src="{{ bg_image }}" alt="{{ clean_name }}" class="product-image">
                                <div class="product-indicator"></div>
                                <div class="category-badge">Pulse</div>
                            </div>
                            <div class="product-content">
                                <h3 class="product-name">{{ clean_name }}</h3>
                                <div class="product-location">
                                    <i class="fas fa-map-marker-alt location-icon"></i>
                                    <span>{{ item.district }}, {{ item.state }}</span>
                                </div>
                                <div class="price-section">
                                    <div class="price-info">
                                        <div class="main-price">‚Çπ{{ "%.1f"|format(item.current_price_kg|float) }} <span class="price-unit">per kg</span></div>
                                        <div class="price-details">
                                            <div class="price-detail">
                                                <span class="price-label">Central Price:</span>
                                                <span class="price-value">‚Çπ{{ item.current_price_kg }}</span>
                                            </div>
                                            <div class="price-detail">
                                                <span class="price-label">Quoted Price:</span>
                                                <span class="price-value">‚Çπ{{ item.max_price_kg or item.current_price_kg }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Spices Section -->
                {% if spices %}
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-title">
                            <div class="category-icon" style="background: linear-gradient(135deg, #dc2626, #991b1b) !important; box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3) !important;">üå∂Ô∏è</div>
                            <div>
                                <div>Spices</div>
                                <div class="category-count">{{ spices|length }} items available</div>
                            </div>
                        </div>
                        <div class="scroll-controls">
                            <button class="scroll-btn scroll-left" onclick="scrollCategory('spices', 'left')">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="scroll-btn scroll-right" onclick="scrollCategory('spices', 'right')">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    <div class="scroll-container">
                        <div class="products-grid-horizontal" id="spices-grid">
                        {% for item in spices %}
                        {% set clean_name = item.commodity.split('(')[0].strip() %}
                        {% set bg_image = card_images.get(clean_name, 'https://images.unsplash.com/photo-1596040033229-a0b3b1c8e4c5?auto=format&fit=crop&w=500&q=60') %}
                        <div class="product-card">
                            <div class="product-image-container">
                                <img src="{{ bg_image }}" alt="{{ clean_name }}" class="product-image">
                                <div class="product-indicator"></div>
                                <div class="category-badge">Spice</div>
                            </div>
                            <div class="product-content">
                                <h3 class="product-name">{{ clean_name }}</h3>
                                <div class="product-location">
                                    <i class="fas fa-map-marker-alt location-icon"></i>
                                    <span>{{ item.district }}, {{ item.state }}</span>
                                </div>
                                <div class="price-section">
                                    <div class="price-info">
                                        <div class="main-price">‚Çπ{{ "%.1f"|format(item.current_price_kg|float) }} <span class="price-unit">per kg</span></div>
                                        <div class="price-details">
                                            <div class="price-detail">
                                                <span class="price-label">Central Price:</span>
                                                <span class="price-value">‚Çπ{{ item.current_price_kg }}</span>
                                            </div>
                                            <div class="price-detail">
                                                <span class="price-label">Quoted Price:</span>
                                                <span class="price-value">‚Çπ{{ item.max_price_kg or item.current_price_kg }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Oilseeds Section -->
                {% if oilseeds %}
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-title">
                            <div class="category-icon" style="background: linear-gradient(135deg, #92400e, #78350f) !important; box-shadow: 0 4px 12px rgba(146, 64, 14, 0.3) !important;">üåª</div>
                            <div>
                                <div>Oilseeds</div>
                                <div class="category-count">{{ oilseeds|length }} items available</div>
                            </div>
                        </div>
                        <div class="scroll-controls">
                            <button class="scroll-btn scroll-left" onclick="scrollCategory('oilseeds', 'left')">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="scroll-btn scroll-right" onclick="scrollCategory('oilseeds', 'right')">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    <div class="scroll-container">
                        <div class="products-grid-horizontal" id="oilseeds-grid">
                        {% for item in oilseeds %}
                        {% set clean_name = item.commodity.split('(')[0].split('Seed')[0].strip() %}
                        {% set bg_image = card_images.get(clean_name, 'https://images.unsplash.com/photo-1589927986089-35812388d1f4?auto=format&fit=crop&w=500&q=60') %}
                        <div class="product-card">
                            <div class="product-image-container">
                                <img src="{{ bg_image }}" alt="{{ clean_name }}" class="product-image">
                                <div class="product-indicator"></div>
                                <div class="category-badge">Oilseed</div>
                            </div>
                            <div class="product-content">
                                <h3 class="product-name">{{ clean_name }}</h3>
                                <div class="product-location">
                                    <i class="fas fa-map-marker-alt location-icon"></i>
                                    <span>{{ item.district }}, {{ item.state }}</span>
                                </div>
                                <div class="price-section">
                                    <div class="price-info">
                                        <div class="main-price">‚Çπ{{ "%.1f"|format(item.current_price_kg|float) }} <span class="price-unit">per kg</span></div>
                                        <div class="price-details">
                                            <div class="price-detail">
                                                <span class="price-label">Central Price:</span>
                                                <span class="price-value">‚Çπ{{ item.current_price_kg }}</span>
                                            </div>
                                            <div class="price-detail">
                                                <span class="price-label">Quoted Price:</span>
                                                <span class="price-value">‚Çπ{{ item.max_price_kg or item.current_price_kg }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Commercial Crops Section -->
                {% if commercial %}
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-title">
                            <div class="category-icon" style="background: linear-gradient(135deg, #64748b, #475569) !important; box-shadow: 0 4px 12px rgba(100, 116, 139, 0.3) !important;">üåø</div>
                            <div>
                                <div>Commercial Crops</div>
                                <div class="category-count">{{ commercial|length }} items available</div>
                            </div>
                        </div>
                        <div class="scroll-controls">
                            <button class="scroll-btn scroll-left" onclick="scrollCategory('commercial', 'left')">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="scroll-btn scroll-right" onclick="scrollCategory('commercial', 'right')">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    <div class="scroll-container">
                        <div class="products-grid-horizontal" id="commercial-grid">
                        {% for item in commercial %}
                        {% set clean_name = item.commodity.split('(')[0].strip() %}
                        {% set bg_image = card_images.get(clean_name, 'https://images.unsplash.com/photo-1594895697660-f38449c258d4?auto=format&fit=crop&w=500&q=60') %}
                        <div class="product-card">
                            <div class="product-image-container">
                                <img src="{{ bg_image }}" alt="{{ clean_name }}" class="product-image">
                                <div class="product-indicator"></div>
                                <div class="category-badge">Commercial</div>
                            </div>
                            <div class="product-content">
                                <h3 class="product-name">{{ clean_name }}</h3>
                                <div class="product-location">
                                    <i class="fas fa-map-marker-alt location-icon"></i>
                                    <span>{{ item.district }}, {{ item.state }}</span>
                                </div>
                                <div class="price-section">
                                    <div class="price-info">
                                        <div class="main-price">‚Çπ{{ "%.1f"|format(item.current_price_kg|float) }} <span class="price-unit">per kg</span></div>
                                        <div class="price-details">
                                            <div class="price-detail">
                                                <span class="price-label">Central Price:</span>
                                                <span class="price-value">‚Çπ{{ item.current_price_kg }}</span>
                                            </div>
                                            <div class="price-detail">
                                                <span class="price-label">Quoted Price:</span>
                                                <span class="price-value">‚Çπ{{ item.max_price_kg or item.current_price_kg }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Animal Products Section -->
                {% if animal %}
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-title">
                            <div class="category-icon" style="background: linear-gradient(135deg, #3b82f6, #2563eb) !important; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3) !important;">ü•õ</div>
                            <div>
                                <div>Animal Products</div>
                                <div class="category-count">{{ animal|length }} items available</div>
                            </div>
                        </div>
                        <div class="scroll-controls">
                            <button class="scroll-btn scroll-left" onclick="scrollCategory('animal', 'left')">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="scroll-btn scroll-right" onclick="scrollCategory('animal', 'right')">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    <div class="scroll-container">
                        <div class="products-grid-horizontal" id="animal-grid">
                        {% for item in animal %}
                        {% set clean_name = item.commodity.split('(')[0].strip() %}
                        {% set bg_image = card_images.get(clean_name, 'https://images.unsplash.com/photo-1563636619-e9143da7973b?auto=format&fit=crop&w=500&q=60') %}
                        <div class="product-card">
                            <div class="product-image-container">
                                <img src="{{ bg_image }}" alt="{{ clean_name }}" class="product-image">
                                <div class="product-indicator"></div>
                                <div class="category-badge">Animal</div>
                            </div>
                            <div class="product-content">
                                <h3 class="product-name">{{ clean_name }}</h3>
                                <div class="product-location">
                                    <i class="fas fa-map-marker-alt location-icon"></i>
                                    <span>{{ item.district }}, {{ item.state }}</span>
                                </div>
                                <div class="price-section">
                                    <div class="price-info">
                                        <div class="main-price">‚Çπ{{ "%.1f"|format(item.current_price_kg|float) }} <span class="price-unit">per kg</span></div>
                                        <div class="price-details">
                                            <div class="price-detail">
                                                <span class="price-label">Central Price:</span>
                                                <span class="price-value">‚Çπ{{ item.current_price_kg }}</span>
                                            </div>
                                            <div class="price-detail">
                                                <span class="price-label">Quoted Price:</span>
                                                <span class="price-value">‚Çπ{{ item.max_price_kg or item.current_price_kg }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Dry Fruits Section -->
                {% if dry_fruits %}
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-title">
                            <div class="category-icon" style="background: linear-gradient(135deg, #a855f7, #9333ea) !important; box-shadow: 0 4px 12px rgba(168, 85, 247, 0.3) !important;">ü•ú</div>
                            <div>
                                <div>Dry Fruits</div>
                                <div class="category-count">{{ dry_fruits|length }} items available</div>
                            </div>
                        </div>
                        <div class="scroll-controls">
                            <button class="scroll-btn scroll-left" onclick="scrollCategory('dry_fruits', 'left')">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="scroll-btn scroll-right" onclick="scrollCategory('dry_fruits', 'right')">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    <div class="scroll-container">
                        <div class="products-grid-horizontal" id="dry_fruits-grid">
                        {% for item in dry_fruits %}
                        {% set clean_name = item.commodity.split('(')[0].strip() %}
                        {% set bg_image = card_images.get(clean_name, 'https://images.unsplash.com/photo-1608797178974-15b35a64ede9?auto=format&fit=crop&w=500&q=60') %}
                        <div class="product-card">
                            <div class="product-image-container">
                                <img src="{{ bg_image }}" alt="{{ clean_name }}" class="product-image">
                                <div class="product-indicator"></div>
                                <div class="category-badge">Dry Fruit</div>
                            </div>
                            <div class="product-content">
                                <h3 class="product-name">{{ clean_name }}</h3>
                                <div class="product-location">
                                    <i class="fas fa-map-marker-alt location-icon"></i>
                                    <span>{{ item.district }}, {{ item.state }}</span>
                                </div>
                                <div class="price-section">
                                    <div class="price-info">
                                        <div class="main-price">‚Çπ{{ "%.1f"|format(item.current_price_kg|float) }} <span class="price-unit">per kg</span></div>
                                        <div class="price-details">
                                            <div class="price-detail">
                                                <span class="price-label">Central Price:</span>
                                                <span class="price-value">‚Çπ{{ item.current_price_kg }}</span>
                                            </div>
                                            <div class="price-detail">
                                                <span class="price-label">Quoted Price:</span>
                                                <span class="price-value">‚Çπ{{ item.max_price_kg or item.current_price_kg }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">üìä</div>
                <h3>No Market Data Available</h3>
                <p>Select a state and district to view market prices</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
// Horizontal scroll functionality for category sections
function scrollCategory(category, direction) {
    const container = document.getElementById(category + '-grid');
    if (!container) return;
    
    const scrollAmount = 300; // pixels to scroll
    const currentScroll = container.parentElement.scrollLeft;
    
    if (direction === 'left') {
        container.parentElement.scrollLeft = currentScroll - scrollAmount;
    } else {
        container.parentElement.scrollLeft = currentScroll + scrollAmount;
    }
    
    // Update button states after scroll
    setTimeout(() => updateScrollButtons(category), 100);
}

// Update scroll button states based on scroll position
function updateScrollButtons(category) {
    const container = document.getElementById(category + '-grid');
    if (!container) return;
    
    const scrollContainer = container.parentElement;
    const leftBtn = document.querySelector(`button[onclick="scrollCategory('${category}', 'left')"]`);
    const rightBtn = document.querySelector(`button[onclick="scrollCategory('${category}', 'right')"]`);
    
    if (leftBtn && rightBtn) {
        // Disable left button if at start
        leftBtn.disabled = scrollContainer.scrollLeft <= 0;
        
        // Disable right button if at end
        const maxScroll = scrollContainer.scrollWidth - scrollContainer.clientWidth;
        rightBtn.disabled = scrollContainer.scrollLeft >= maxScroll - 1;
    }
}

// Initialize button states on page load
document.addEventListener('DOMContentLoaded', function() {
    const categories = ['vegetables', 'fruits', 'cereals', 'pulses', 'oilseeds', 'spices', 'commercial', 'dry_fruits', 'animal'];
    
    categories.forEach(category => {
        updateScrollButtons(category);
        
        // Add scroll event listener to update buttons during manual scrolling
        const container = document.getElementById(category + '-grid');
        if (container && container.parentElement) {
            container.parentElement.addEventListener('scroll', () => updateScrollButtons(category));
        }
    });
});
</script>

<script id="states-data" type="application/json">
    {{ (states_districts or {}) | tojson | safe }}
</script>
<script src="{{ url_for('static', filename='js/market_watch.js') }}"></script>

{% endblock %}